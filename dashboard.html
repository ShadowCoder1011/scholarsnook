<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ScholarsNook — Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .hero{
      margin: 0 -20px 20px -20px;
      padding: 60px 20px;
      text-align: center;
      background: linear-gradient(135deg, var(--ths-green) 0%, var(--ths-violet) 100%);
      color: #fff;
    }
    .hero h1{ margin: 0; font-size: 2.4rem; }
    .hero p{ margin: 8px 0 0 0; opacity: .9; }
    .leaderboard{ margin: 12px 0; padding-left: 24px; font-size: 1.1rem; }
    .leaderboard li{ margin: 8px 0; color: var(--ths-violet); }
    .leaderboard .points{ font-weight: 700; color: var(--ths-green); }
  </style>
</head>
<body>
<main class="container">
  <header class="brand">
    <h1>ScholarsNook</h1>
    <p class="tag">Track your points • Flex your wins</p>
  </header>

  <section class="hero">
    <h1>Welcome, <span id="userName"></span>!</h1>
    <p>Your current balance</p>
    <div class="points" style="font-size: 3rem; margin-top: 12px;">
      <span id="userPoints">0</span> pts
    </div>
  </section>

  <section class="card">
    <h2>Leaderboard – Top 3</h2>
    <ol id="top3" class="leaderboard"></ol>
    <p class="muted">More features coming soon…</p>
    <div class="actions">
      <a href="login.html" class="alt-btn" style="background: var(--muted);">Log out</a>
    </div>
  </section>

  <section class="calendar">
    <h2>Up-coming Events</h2>
      <div>
      <ul id="cal"></ul>
      </div>
        
      <script>
      const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vStp6kZ6fCNHYDHxJlQjPl84GM-V83PsQQzEFaEpRQza7GEGctPoFZ7ngw0mgMn8Do-ItW5JGfJCjcs/pub?output=csv';
      
      (async () => {
        const res = await fetch(CSV_URL);
        const txt = await res.text();
        const rows = txt.split('\n').slice(1); // skip header
        const now = new Date();
        const html = rows
          .map(r => r.split(',').map(c => c.replace(/^"(.*)"$/, '$1').trim()))
          .filter(([, , , date]) => new Date(date) >= now)          // future only
          .slice(0, 5)                                               // next 5
          .map(([time, title, name, date]) =>
            `<li><strong>${title}</strong> – ${date} ${time}<br><small>${name}</small></li>`
          ).join('');
        document.getElementById('cal').innerHTML = html || '<li>No upcoming events.</li>';
      })();
      </script>
  </section>
</main>

<script>
const SHEET_ID = '1zCRAV4a2mGVXpq3wmrUqpPSaBOVcxKSK-8Rhk31gI4g';
const CSV_URL  = `https://docs.google.com/spreadsheets/d/e/2PACX-1vTQsu-SF_y4VrOaNv1HL-JUZuZW8cyB0auP0yoaL3CsLRGns27IIzO9cT1kvjvBa4wk2FUOS40E3Zbq/pub?output=csv`;

const user = sessionStorage.getItem('user');
if (!user) location.href = 'login.html';

(async () => {
  const res = await fetch(CSV_URL);
  const txt = await res.text();
  const rows = txt.split('\n').slice(1);            // skip header
  let myPts = 0;
  const board = [];
  for (const raw of rows) {
    console.log('ROW:', raw, 'COLS:', raw.split(','));
    const cols = raw.split(',').map(c => c.replace(/^"(.*)"$/, '$1').trim());
    const [,,,u]      = cols;          // username (col 3)
    const [,name]     = cols;          // name      (col 1)
    const pts         = parseInt(cols[5]) || 0; // points (col 5)

    if (u === user) myPts = pts;
    if (name && pts) board.push({ name, pts });
  }
  document.getElementById('userName').textContent = user;
  document.getElementById('userPoints').textContent = myPts.toLocaleString();

  // top-3
  board.sort((a, b) => b.pts - a.pts);
  const html = board.slice(0, 3).map(p =>
    `<li>${p.name} – <span class="points">${p.pts.toLocaleString()} pts</span></li>`
  ).join('');
  document.getElementById('top3').innerHTML = html;
})();
</script>
</body>
</html>


